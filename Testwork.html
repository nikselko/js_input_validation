<!DOCTYPE html>
<html lang="en">

<head>
    <!--метаданные-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrolling Presentation with Form</title>

    <!--скрипт и сс на телефон-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@19.2.19/build/css/intlTelInput.css">
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.2.19/build/js/intlTelInput.min.js"></script>

    <!--либп бутсрап-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!--либа валидейт-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/validate.js/0.13.1/validate.min.js"></script>
    <style>
        .custom-body {
            background: #c4defd;
        }
    </style>
</head>

<body class="custom-body">

<!--пропадаюзий стартовый скрин-->
<div id="home" class="container">
    <h1>ЗАРАБАТЫВАЙТЕ 5000 В МЕСЯЦ С WHATSAPP BOT AI</h1>
    <p>Воплотите свои мечты в жизнь Воплотите свои мечты в жизнь Воплотите свои мечты в жизнь Воплотите свои мечты в
        жизнь</p>
    <button type="button" onclick="setStep('question 1')">Оставить заявку</button>
</div>

<!--Форма с селекциями флажков-->
<div id="form" class="container d-none">
    <h2>Fill out the Form</h2>
    <form id="userForm">
        <section id='section 1' class="mb-3 d-none">
            <label class="form-label">kakdela</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q1" id="1" value="male" required>
                <label class="form-check-label" for="1">Male</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q1" id="2" value="female" required>
                <label class="form-check-label" for="2">Female</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q1" id="3" value="other" required>
                <label class="form-check-label" for="3">Other</label>
            </div>
            <button type="button" onclick="setStep('question 2')">Дальше</button>
        </section>

        <section id='section 2' class="mb-3 d-none">
            <label class="form-label">Tuda suda</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q2" id="11" value="male" required>
                <label class="form-check-label" for="11">Male</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q2" id="22" value="female" required>
                <label class="form-check-label" for="22">Female</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q2" id="33" value="other" required>
                <label class="form-check-label" for="33">Other</label>
            </div>
            <button type="button" onclick="setStep('question 3')">Дальше</button>
        </section>

        <section id='section 3' class="mb-3 d-none">
            <label class="form-label">Sho tam</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q3" id="111" value="male" required>
                <label class="form-check-label" for="111">Male</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q3" id="222" value="female" required>
                <label class="form-check-label" for="222">Female</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q3" id="333" value="other" required>
                <label class="form-check-label" for="333">Other</label>
            </div>
            <button type="button" onclick="setStep('user-info')">Дальше</button>
        </section>

        <section id='user-info' class="d-none">
            <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
                <div id="name_error" class="alert-danger alert d-none"></div>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
                <div id="email_error" class="alert-danger alert d-none"></div>
            </div>
            <div class="mb-3">
                <label for="phonenumber" class="form-label"></label>
                <input class="form-control" id="phonenumber" name="phonenumber" rows="3" required/>
                <div id="phone_error" class="alert-danger alert d-none"></div>
            </div>
            <button id="submit_btn" type="submit" class="btn btn-primary" disabled="true">Submit</button>
        </section>
    </form>
</div>

<!--скрипт на свич показа обьектов-->
<script>

    // динамический свич/кейс секций
    function setStep(step) {
        switch (step) {
            case 'home':
                break;

            case 'question 1':
                document.getElementById('home').classList.add('d-none')
                document.getElementById('form').classList.remove('d-none')
                document.getElementById('section 1').classList.remove('d-none')
                break;

            case 'question 2':
                document.getElementById('section 1').classList.add('d-none')
                document.getElementById('section 2').classList.remove('d-none')
                break;

            case 'question 3':
                document.getElementById('section 2').classList.add('d-none')
                document.getElementById('section 3').classList.remove('d-none')
                break;

            case 'user-info':
                document.getElementById('section 3').classList.add('d-none')
                document.getElementById('user-info').classList.remove('d-none')
                document.getElementById('user-info').classList.remove('d-none')
                document.getElementById('submit_btn').removeAttribute('disabled')
                break;
        }
    }

    //инизиализация телеф инпута
    const input = document.getElementById("phonenumber");
    const iti = window.intlTelInput(input, {
        useFullscreenPopup: false,
        initialCountry: "ru",
        separateDialCode: true,
        utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@19.2.19/build/js/utils.js",

    });

    // основная функция которая возвращает обьект форму юзера
    function getFormJson() {
        const form = document.getElementById('userForm');
        const formData = {};
        for (let i = 0; i < form.elements.length; i++) {
            const element = form.elements[i];

            if (element.name && element.type !== 'submit') {
                if (element.type === 'radio' || element.type === 'checkbox') {
                    formData[element.name] = element.checked ? element.value : null;
                } else {
                    formData[element.name] = element.value;
                }
            }
        }

        //удаление ненужных тикеров
        delete formData.q1;
        delete formData.q2;
        delete formData.q3;

        return formData
    }

    // функция на сабмит
    const submitForm = () => {
        console.debug('submit')

        //проверка на полей валидейт либы
        const errors = validate(document.getElementById('form'), {
            name: {
                // You need to pick a username too
                presence: true,
                length: {
                    minimum: 3,
                    maximum: 20
                },
                format: {
                    pattern: "[a-z]+",
                    flags: "i",
                    message: "can only contain letters"
                }
            },
            email: {
                // Email is required
                presence: true,
                // and must be an email (duh)
                email: true
            },
        })

        //проверка ошибок с телефоном
        document.getElementById('phonenumber').value.trim()
        const phoneErrors = !iti.isValidNumber()

        document.getElementById('name_error').classList.add('d-none')
        document.getElementById('email_error').classList.add('d-none')
        document.getElementById('phone_error').classList.add('d-none')


        if (errors || phoneErrors) {
            //выводим эроры под полями

            if (errors?.name) {
                document.getElementById('name_error').innerHTML = errors.name;
                document.getElementById('name_error').classList.remove('d-none')
            }
            if (errors?.email) {
                document.getElementById('email_error').innerHTML = errors.email;
                document.getElementById('email_error').classList.remove('d-none')
            }
            if (phoneErrors) {
                const errorCode = iti.getValidationError();
                const errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];
                document.getElementById('phone_error').innerHTML = errorMap[errorCode];
                document.getElementById('phone_error').classList.remove('d-none')
            }
        } else {
            //если поля и номер телефона валидны то создаем форму аякс

            //записываем нашу форму в клас
            const userformclass = getFormJson();
            console.debug(userformclass);

            //обеькт реквеста аякс
            const xhr = new XMLHttpRequest();

            //вместо "backend.php" нужно вставить вашу ссылку
            xhr.open('POST', 'backend.php', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify(userformclass));
        }
    }

</script>

</body>

</html>

<!--nikselko 2023-->
